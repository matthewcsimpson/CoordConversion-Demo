<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>title</title>

    <script src="https://unpkg.com/coordconversion@latest/dist/index.global.js"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>

<body>
    <h1>My Google Map</h1>

    <div style="margin-bottom: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 5px;">
        <h3>Enter Coordinates</h3>
        <form id="coordinateForm">
            <label for="latitude">Latitude (decimal degrees):</label>
            <input type="number" id="latitude" step="any" placeholder="37.7749"
                style="margin: 5px; padding: 5px; width: 150px;">

            <label for="longitude">Longitude (decimal degrees):</label>
            <input type="number" id="longitude" step="any" placeholder="-122.4194"
                style="margin: 5px; padding: 5px; width: 150px;">

            <button type="submit"
                style="margin: 5px; padding: 5px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">Go
                to Location</button>
            <button type="button" id="currentLocationBtn"
                style="margin: 5px; padding: 5px 15px; background-color: #2196F3; color: white; border: none; border-radius: 3px; cursor: pointer;">Use
                Current Location</button>
        </form>

        <div id="ddCoordinates"
            style="margin-top: 15px; padding: 10px; background-color: #e8f5e8; border: 2px solid #4CAF50; border-radius: 3px; font-family: monospace;">
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="ddToggle" checked style="transform: scale(1.2);">
                <strong>ðŸŸ¢ DD Format:</strong> <span id="ddDisplay">--</span>
            </label>
        </div>

        <div id="dmCoordinates"
            style="margin-top: 10px; padding: 10px; background-color: #fff3e0; border: 2px solid #FF9800; border-radius: 3px; font-family: monospace;">
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="dmToggle" checked style="transform: scale(1.2);">
                <strong>ðŸŸ  DM Format:</strong> <span id="dmDisplay">--</span>
            </label>
        </div>

        <div id="dmsCoordinates"
            style="margin-top: 10px; padding: 10px; background-color: #e3f2fd; border: 2px solid #2196F3; border-radius: 3px; font-family: monospace;">
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="dmsToggle" checked style="transform: scale(1.2);">
                <strong>ðŸ”µ DMS Format:</strong> <span id="dmsDisplay">--</span>
            </label>
        </div>

        <div id="inputCoordinates"
            style="margin-top: 10px; padding: 10px; background-color: #fce4ec; border: 2px solid #E91E63; border-radius: 3px; font-family: monospace;">
            <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="inputToggle" checked style="transform: scale(1.2);">
                <strong>ðŸ”´ Input Format:</strong> <span id="inputDisplay">--</span>
            </label>
        </div>
    </div>

    <div id="map"></div>

    <script>
        let map;
        let markers = {
            input: null,
            dd: null,
            dm: null,
            dms: null
        };

        // Initialize and add the map
        function initMap() {
            // Default location (San Francisco)
            const defaultLocation = { lat: 37.7749, lng: -122.4194 };

            // Create the map
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 13,
                center: defaultLocation,
            });

            // Create initial markers for each format
            markers.input = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                title: "Input coordinates",
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                }
            });

            markers.dd = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                title: "DD Format",
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
                }
            });

            markers.dm = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                title: "DM Format",
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/orange-dot.png'
                }
            });

            markers.dms = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                title: "DMS Format",
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                }
            });

            // Set up form event listener
            document.getElementById('coordinateForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const lat = parseFloat(document.getElementById('latitude').value);
                const lng = parseFloat(document.getElementById('longitude').value);

                if (isValidCoordinate(lat, lng)) {
                    updateMapLocation(lat, lng, "Custom location");
                } else {
                    alert("Please enter valid coordinates. Latitude must be between -90 and 90, longitude between -180 and 180.");
                }
            });

            // Set up current location button
            document.getElementById('currentLocationBtn').addEventListener('click', function () {
                getCurrentLocation();
            });

            // Set up toggle event listeners
            document.getElementById('inputToggle').addEventListener('change', function () {
                markers.input.setVisible(this.checked);
            });

            document.getElementById('ddToggle').addEventListener('change', function () {
                markers.dd.setVisible(this.checked);
            });

            document.getElementById('dmToggle').addEventListener('change', function () {
                markers.dm.setVisible(this.checked);
            });

            document.getElementById('dmsToggle').addEventListener('change', function () {
                markers.dms.setVisible(this.checked);
            });

            // Try to get current location on page load
            getCurrentLocation();
        }

        function isValidCoordinate(lat, lng) {
            return !isNaN(lat) && !isNaN(lng) &&
                lat >= -90 && lat <= 90 &&
                lng >= -180 && lng <= 180;
        }

        function updateMapLocation(lat, lng, title) {
            const inputLocation = { lat: lat, lng: lng };

            // Update map center to input coordinates
            map.setCenter(inputLocation);
            map.setZoom(13);

            // Update form fields
            document.getElementById('latitude').value = lat.toFixed(6);
            document.getElementById('longitude').value = lng.toFixed(6);

            // Display input coordinates
            document.getElementById('inputDisplay').textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;

            // Update input marker (red)
            markers.input.setPosition(inputLocation);
            markers.input.setTitle(`Input: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
            markers.input.setVisible(document.getElementById('inputToggle').checked);

            // Convert to DD format using coordconversion library
            try {
                const [latStrDD, lonStrDD] = CoordConversion.formatDDPair(
                    ...CoordConversion.parsePairToDD(lat, lng)
                );
                document.getElementById('ddDisplay').textContent = `${latStrDD}, ${lonStrDD}`;

                // Parse DD coordinates back to numbers for mapping
                const [ddLatObj, ddLngObj] = CoordConversion.parsePairToDD(latStrDD, lonStrDD);
                const ddLocation = { lat: ddLatObj.degrees, lng: ddLngObj.degrees };
                markers.dd.setPosition(ddLocation);
                markers.dd.setTitle(`DD: ${latStrDD}, ${lonStrDD}`);
                markers.dd.setVisible(document.getElementById('ddToggle').checked);
            } catch (error) {
                console.error("Error converting coordinates to DD format:", error);
                document.getElementById('ddDisplay').textContent = "Conversion error";
            }

            // Convert to DM format using coordconversion library
            try {
                // Step 1: Parse input to DD objects
                const [latDDObj, lonDDObj] = CoordConversion.parsePairToDD(lat, lng);
                console.log('Step 1 - Parsed to DD objects:', latDDObj, lonDDObj);

                // Step 2: Convert DD objects to DM objects
                const [latDM, lonDM] = CoordConversion.ddPairToDM(latDDObj, lonDDObj);
                console.log('Step 2 - Converted to DM objects:', latDM, lonDM);

                // Step 3: Format DM objects to strings
                const [latStrDM, lonStrDM] = CoordConversion.formatDMPair(latDM, lonDM);
                console.log('Step 3 - Formatted DM strings:', latStrDM, lonStrDM);
                document.getElementById('dmDisplay').textContent = `${latStrDM}, ${lonStrDM}`;

                // Step 4: Convert DM objects back to DD for mapping using dmPairToDD
                const [dmLatObj, dmLngObj] = CoordConversion.dmPairToDD(latDM, lonDM);
                const dmLocation = { lat: dmLatObj.degrees, lng: dmLngObj.degrees };
                console.log('Step 4 - DM converted back to DD:', dmLocation);
                markers.dm.setPosition(dmLocation);
                markers.dm.setTitle(`DM: ${latStrDM}, ${lonStrDM} -> ${dmLatObj.degrees.toFixed(8)}, ${dmLngObj.degrees.toFixed(8)}`);
                markers.dm.setVisible(document.getElementById('dmToggle').checked);
            } catch (error) {
                console.error("Error converting coordinates to DM format:", error);
                document.getElementById('dmDisplay').textContent = "Conversion error";
            }

            // Convert to DMS format using coordconversion library
            try {
                // Step 1: Parse input to DD objects (same as DM)
                const [latDDObj, lonDDObj] = CoordConversion.parsePairToDD(lat, lng);
                console.log('DMS Step 1 - Parsed to DD objects:', latDDObj, lonDDObj);

                // Step 2: Convert DD objects to DMS objects
                const [latDMS, lonDMS] = CoordConversion.ddPairToDMS(latDDObj, lonDDObj);
                console.log('DMS Step 2 - Converted to DMS objects:', latDMS, lonDMS);

                // Step 3: Format DMS objects to strings
                const [latStrDMS, lonStrDMS] = CoordConversion.formatDMSPair(latDMS, lonDMS);
                console.log('DMS Step 3 - Formatted DMS strings:', latStrDMS, lonStrDMS);
                document.getElementById('dmsDisplay').textContent = `${latStrDMS}, ${lonStrDMS}`;

                // Step 4: Convert DMS objects back to DD for mapping using dmsPairToDD
                const [dmsLatObj, dmsLngObj] = CoordConversion.dmsPairToDD(latDMS, lonDMS);
                const dmsLocation = { lat: dmsLatObj.degrees, lng: dmsLngObj.degrees };
                console.log('DMS Step 4 - DMS converted back to DD:', dmsLocation);
                markers.dms.setPosition(dmsLocation);
                markers.dms.setTitle(`DMS: ${latStrDMS}, ${lonStrDMS} -> ${dmsLatObj.degrees.toFixed(8)}, ${dmsLngObj.degrees.toFixed(8)}`);
                markers.dms.setVisible(document.getElementById('dmsToggle').checked);
            } catch (error) {
                console.error("Error converting coordinates to DMS format:", error);
                document.getElementById('dmsDisplay').textContent = "Conversion error";
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        updateMapLocation(lat, lng, "Your current location");
                    },
                    function (error) {
                        console.error("Error getting location:", error);
                        alert("Could not get your current location. Error: " + error.message);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>


    <!-- Load the Google Maps JavaScript API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiTbVu2yY6A_BIbeNPv0wdyCJNLaHsGic&callback=initMap">
        </script>
</body>

</html>